"use strict";const defineProperty=Object.defineProperty,getKeys=Object.keys||function(t){let e=[];for(let r in t)e.push(r);return e},_toString=Object.prototype.toString,isObject=function(t){return"[object Object]"===_toString.call(t)},isPrimary=function(t){return["[object Number]","[object String]","[object Boolean]"].indexOf(_toString.call(t))>-1},isArray=Array.isArray||function(t){return"[object Array]"===_toString.call(t)},isFunction=function(t){return t instanceof Function||"function"==typeof t||"[object Function]"===_toString.call(t)},hasProperty=function(t,e){return Object.hasOwnProperty?Object.hasOwnProperty.call(t,e):e in t},warn=t=>{throw new Error(t)},isSame=function(t,e){if(isPrimary(t))return!!isPrimary(e)&&t===e;if(isArray(t))return!!isArray(e)&&(t.length===e.length&&t.every((t,r)=>t===e[r]));if(isObject(t)){let r=getKeys(t),i=getKeys(e);return r.length===i.length&&(r.sort(),i.sort(),!!r.every((t,e)=>t===i[e])&&r.every((r,i)=>isSame(t[r],e[r])))}return!0};function push(...t){return Array.prototype.push.call(this,...t)}function pop(){return Array.prototype.pop.call(this)}function shift(){return Array.prototype.shift.call(this)}function unshift(...t){return Array.prototype.unshift.call(this,...t)}function splice(t=0,e=0,r=[]){return Array.prototype.splice.call(this,t,e,r)}function reverse(){return Array.prototype.reverse.call(this)}function sort(t){return Array.prototype.sort.call(this,t)}function map(t){return Array.prototype.map.call(this,t)}function forEach(t){return Array.prototype.forEach.call(this,t)}function every(t){return Array.prototype.every.call(this,t)}function some(t){return Array.prototype.some.call(this,t)}function filter(t){return Array.prototype.filter.call(this,t)}function reduce(t,e){return Array.prototype.reduce.call(this,t,e)}function concat(...t){return Array.prototype.concat.call(this,...t)}function join(t){return Array.prototype.join.call(this,t)}const methods=["push","pop","shift","unshift","splice","reverse","sort","map","forEach","every","some","filter","reduce","concat","join"];var dfa=Object.freeze({push:push,pop:pop,shift:shift,unshift:unshift,splice:splice,reverse:reverse,sort:sort,map:map,forEach:forEach,every:every,some:some,filter:filter,reduce:reduce,concat:concat,join:join,methods:methods});class DoxArray{constructor(t,e,r=[]){this.runtimeEvent={isLegal:!1,value:t=>{}},this.eventsStore={},this.dataToProxy=[],this.proxy={length:0},this.delicate=!0,this.parentEvents=[],this.target=t,this.root=e,this.keys=getKeys(t),this.parentEvents=r,this.init()}init(){this.keys.forEach(t=>{this.eventsStore[t]=[],this.proxy[t]=void 0,defineProperty(this.proxy,t,{get:()=>(this.runtimeEvent.isLegal&&(this.eventsStore[t]=this.eventsStore[t].reduce((t,e)=>(e!==t[0]&&t.push(e),t),[this.runtimeEvent.value])),this.dataToProxy[t]instanceof DoxObject||this.dataToProxy[t]instanceof DoxArray?(this.runtimeEvent.isLegal&&this.dataToProxy[t].extendsRuntimeEvent(this.runtimeEvent),this.dataToProxy[t].observe()):isPrimary(this.dataToProxy[t])?this.dataToProxy[t]:void 0),set:e=>{isSame(e,this.dataToProxy[t])||(isPrimary(e)?this.dataToProxy[t]=e:isObject(e)?this.dataToProxy[t]=new DoxObject(e,this.root):isArray(e)&&(this.dataToProxy[t]=new DoxArray(e,this.root,this.parentEvents))),this.delicate&&this.eventsStore[t].forEach(t=>t(this.root.observe()))}}),this.proxy[t]=this.target[t]}),defineProperty(this.proxy,"length",{enumerable:!1,configurable:!1,writable:!0,value:this.target.length}),methods.forEach(t=>{defineProperty(this.proxy,t,{configurable:!1,writable:!1,enumerable:!1,value:(...e)=>{this.toggleDelicate(!1);let r=dfa[t].call(this.proxy,...e);return this.parentEvents.forEach(t=>{t(this.root.observe())}),this.toggleDelicate(),r}})})}toggleDelicate(t=!0){this.delicate=t}extendsRuntimeEvent(t){this.runtimeEvent=t}observe(){return this.proxy}}class DoxObject{constructor(t,e){this.keys=[],this.runtimeEvent={isLegal:!1,value:t=>{}},this.eventsStore={},this.dataToProxy={},this.proxy={},this.delicate=!1,this.target=t,this.keys=getKeys(t),this.root=e,this.init()}init(){this.keys.forEach(t=>{this.eventsStore[t]=[],this.proxy[t]=void 0,defineProperty(this.proxy,t,{get:()=>(this.runtimeEvent.isLegal&&(this.eventsStore[t]=this.eventsStore[t].reduce((t,e)=>(e!==t[0]&&t.push(e),t),[this.runtimeEvent.value])),this.dataToProxy[t]instanceof DoxObject||this.dataToProxy[t]instanceof DoxArray?(this.runtimeEvent.isLegal&&this.dataToProxy[t].extendsRuntimeEvent(this.runtimeEvent),this.dataToProxy[t].observe()):isPrimary(this.dataToProxy[t])?this.dataToProxy[t]:void 0),set:e=>{isSame(this.dataToProxy[t],e)||(isPrimary(e)?(this.dataToProxy[t]=e,this.eventsStore[t].forEach(t=>t(this.root.observe()))):isObject(e)?(this.dataToProxy[t]=new DoxObject(e,this.root),this.eventsStore[t].forEach(t=>{this.root.subscribe(t)})):isArray(e)&&(this.dataToProxy[t]=new DoxArray(e,this.root,this.eventsStore[t]),this.eventsStore[t].forEach(t=>{this.root.subscribe(t)})))}}),this.proxy[t]=this.target[t]})}extendsRuntimeEvent(t){this.runtimeEvent=t}observe(){return this.proxy}}class DoxJS{constructor(t){isObject(t)?this.sourceObject=new DoxObject(t,this):warn("DoxJS only accept object as argument")}subscribe(t,e=!1,r){if(isFunction(t)){this.runtimeEvent={isLegal:!0,value:t};let r=()=>{this.sourceObject.extendsRuntimeEvent(this.runtimeEvent),t(this.sourceObject.observe()),this.runtimeEvent.isLegal=!1};return e?r:r()}"[object String]"===_toString.call(t)?hasProperty(this.listeners,t)&&(r?this.subscribe(this.listeners[t].bind(r),e):this.subscribe(this.listeners[t],e)):warn("First parameter of subscribe should be Function or String")}bindListeners(t={}){this.listeners=t}observe(){return this.sourceObject.observe()}bindActions(t={}){this.actions=t}dispatch(t,...e){hasProperty(this.actions,t)&&this.actions[t](this.sourceObject.observe(),...e)}}module.exports=DoxJS;
